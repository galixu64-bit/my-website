
const translations = {
    zh: {

        'login': 'ç™»å½•',
        'logout': 'ç™»å‡º',
        'register': 'æ³¨å†Œ',
        'cancel': 'å–æ¶ˆ',
        'submit': 'æäº¤',
        'save': 'ä¿å­˜',
        'delete': 'åˆ é™¤',
        'edit': 'ç¼–è¾‘',
        'back': 'è¿”å›',
        'search': 'æœç´¢',
        'filter': 'ç­›é€‰',
        'reset': 'é‡ç½®',
        'confirm': 'ç¡®è®¤',
        'close': 'å…³é—­',
        'loading': 'åŠ è½½ä¸­...',
        'error': 'é”™è¯¯',
        'success': 'æˆåŠŸ',

        'siteName': 'dragbit',
        'siteDescription': 'ä¼˜è´¨èµ„æºï¼Œå…è´¹ä¸‹è½½',
        'home': 'é¦–é¡µ',
        'myResources': 'æˆ‘çš„èµ„æº',
        'addResource': 'æ·»åŠ èµ„æº',
        'profile': 'ä¸ªäººä¸­å¿ƒ',
        'personalCenter': 'ä¸ªäººä¸­å¿ƒ',
        'loginRequired': 'éœ€è¦ç™»å½•',
        'loginRequiredMessage': 'æ‚¨éœ€è¦ç™»å½•æ‰èƒ½æŸ¥çœ‹èµ„æº\nè¯·ç™»å½•æˆ–æ³¨å†Œ',

        'resources': 'èµ„æº',
        'allCategories': 'å…¨éƒ¨',
        'filterAll': 'å…¨éƒ¨',
        'filterSoftware': 'è½¯ä»¶',
        'filterDocument': 'æ–‡æ¡£',
        'filterMedia': 'åª’ä½“',
        'filterWebsite': 'ç½‘ç«™',
        'filterOther': 'å…¶ä»–',
        'software': 'è½¯ä»¶',
        'document': 'æ–‡æ¡£',
        'media': 'åª’ä½“',
        'website': 'ç½‘ç«™',
        'other': 'å…¶ä»–',
        'searchPlaceholder': 'æœç´¢èµ„æº...',
        'addResourceButton': '+ æ·»åŠ èµ„æº',
        'visitWebsite': 'è®¿é—®ç½‘ç«™',
        'download': 'ä¸‹è½½',
        'downloadLinkNotConfigured': 'dragbit "{name}" çš„ä¸‹è½½é“¾æ¥å°šæœªé…ç½®ã€‚',
        'viewDetails': 'æŸ¥çœ‹è¯¦æƒ…',
        'comments': 'è¯„è®º',
        'uploadedBy': 'å‘å¸ƒè€…',
        'uploader': 'ä¸Šä¼ è€…ï¼š',
        'anonymousUser': 'åŒ¿åç”¨æˆ·',
        'uploadedAt': 'å‘å¸ƒæ—¶é—´',
        'tags': 'æ ‡ç­¾',
        'category': 'åˆ†ç±»',
        'description': 'æè¿°',
        'author': 'ä½œè€…',
        'noCommentsYet': 'æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼',
        'loginToComment': 'è¯·ç™»å½•åè¯„è®º',
        'viewComments': 'æŸ¥çœ‹è¯„è®º',

        'loginTitle': 'ç™»å½•èµ„æºåº“',
        'loginSubtitle': 'è´¦å·ç™»å½•ï¼Œç•…äº«é«˜è´¨é‡èµ„æºå…è´¹ä¸‹è½½ï¼',
        'username': 'ç”¨æˆ·å',
        'emailOrUsername': 'é‚®ç®±æˆ–ç”¨æˆ·å',
        'password': 'å¯†ç ',
        'usernamePlaceholder': 'è¾“å…¥ç”¨æˆ·åï¼ˆ3-20ä¸ªå­—ç¬¦ï¼‰',
        'usernamePlaceholderOptional': 'è¾“å…¥ç”¨æˆ·åï¼ˆå¯é€‰ï¼Œä¸å¡«åˆ™ä½¿ç”¨é‚®ç®±å‰ç¼€ï¼‰',
        'loginPlaceholder': 'è¾“å…¥é‚®ç®±æˆ–ç”¨æˆ·å',
        'passwordPlaceholder': 'è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰',
        'confirmPasswordPlaceholder': 'å†æ¬¡è¾“å…¥å¯†ç ',
        'loginButton': 'ç™»å½•',
        'registerButton': 'æ³¨å†Œ',
        'demoAccount': 'æ¼”ç¤ºè´¦å·ï¼š',
        'or': 'æˆ–',

        'registerTitle': 'âœ¨ æ³¨å†Œ',
        'registerSubtitle': 'åˆ›å»ºè´¦æˆ·å¼€å§‹ä½¿ç”¨',
        'confirmPassword': 'ç¡®è®¤å¯†ç ',
        'email': 'é‚®ç®±',
        'verificationCode': 'éªŒè¯ç ',
        'sendCode': 'å‘é€éªŒè¯ç ',
        'codeSentTo': 'éªŒè¯ç å°†å‘é€åˆ°æ­¤é‚®ç®±',
        'registerSubmit': 'æ³¨å†Œ',
        'alreadyHaveAccount': 'å·²æœ‰è´¦æˆ·ï¼Ÿ',
        'loginNow': 'ç«‹å³ç™»å½•',
        'backToHome': 'â† è¿”å›é¦–é¡µ',
        'enterCode': 'è¯·è¾“å…¥éªŒè¯ç ',

        'usernameLengthError': 'ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´',
        'passwordLengthError': 'å¯†ç é•¿åº¦è‡³å°‘6ä¸ªå­—ç¬¦',
        'passwordMismatch': 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´',
        'emailRequired': 'è¯·è¾“å…¥é‚®ç®±åœ°å€',
        'emailInvalid': 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€',
        'codeRequired': 'è¯·è¾“å…¥éªŒè¯ç ',
        'codeError': 'éªŒè¯ç é”™è¯¯',
        'codeExpired': 'éªŒè¯ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°å‘é€',
        'codeNotSent': 'è¯·å…ˆå‘é€éªŒè¯ç ',
        'codeVerificationFailed': 'éªŒè¯ç éªŒè¯åŠŸèƒ½æœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•',
        'registerSuccess': 'æ³¨å†ŒæˆåŠŸï¼æ­£åœ¨è·³è½¬åˆ°ç™»å½•é¡µé¢...',
        'registerFailed': 'æ³¨å†Œå¤±è´¥',
        'registerFailedRetry': 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
        'codeSentSuccess': 'éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼Œè¯·æŸ¥æ”¶ï¼',
        'codeSendFailed': 'é‚®ä»¶å‘é€å¤±è´¥ã€‚',
        'codeSendFailedConfig': 'è¯·æ£€æŸ¥æ¨¡æ¿é…ç½®æˆ–å˜é‡åç§°æ˜¯å¦æ­£ç¡®ã€‚',
        'codeSendFailedAuth': 'è®¤è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Public Key æ˜¯å¦æ­£ç¡®ã€‚',
        'codeSendFailedError': 'é”™è¯¯ä»£ç ï¼š{status}ï¼Œè¯¦ç»†ä¿¡æ¯ï¼š{details}',
        'verificationCodeMessage': 'æ‚¨çš„éªŒè¯ç æ˜¯ï¼š{code}ï¼Œæœ‰æ•ˆæœŸä¸º5åˆ†é’Ÿã€‚',
        'codeCountdown': '{seconds}ç§’åå¯é‡æ–°å‘é€',

        'myResourcesTitle': 'æˆ‘çš„èµ„æº',
        'myResourcesSubtitle': 'è¿™é‡Œå±•ç¤ºä½ åœ¨dragbitä¸Šä¼ çš„æ‰€æœ‰èµ„æº',
        'noMyResources': 'ä½ è¿˜æ²¡æœ‰ä¸Šä¼ ä»»ä½•èµ„æº',
        'addFirstResource': 'æ·»åŠ ç¬¬ä¸€ä¸ªèµ„æº',
        'backToMain': 'è¿”å›ä¸»é¡µ',

        'addResourceTitle': 'â• æ·»åŠ èµ„æº',
        'addResourceSubtitle': 'èµ„æºå°†æ”¶å½•åœ¨ dragbit â€”â€” ä¸€ä¸ªä¼˜è´¨èµ„æºç½‘ç«™',
        'addNewResource': 'æ·»åŠ æ–°èµ„æº',
        'resourceName': 'èµ„æºåç§°',
        'resourceDescription': 'èµ„æºæè¿°',
        'resourceDetails': 'è¯¦ç»†è¯´æ˜',
        'resourceTags': 'æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰',
        'exampleTags': 'ä¾‹å¦‚ï¼šå…è´¹,å¼€æº,Windows,ä¸­æ–‡',
        'tagsHelp': 'è¾“å…¥å¤šä¸ªæ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šå…è´¹,å¼€æº,Windows',
        'displayImage': 'å±•ç¤ºå›¾ç‰‡URL',
        'displayVideo': 'å±•ç¤ºè§†é¢‘URL',
        'displayImagePlaceholder': 'è¾“å…¥å›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰',
        'displayVideoPlaceholder': 'è¾“å…¥è§†é¢‘URLï¼ˆå¯é€‰ï¼‰',
        'imageHelp': 'æ”¯æŒ jpg, png, gif æ ¼å¼',
        'videoHelp': 'æ”¯æŒ YouTube, Bilibili, æˆ–å…¶ä»–è§†é¢‘é“¾æ¥',
        'resourceLink': 'èµ„æºé“¾æ¥',
        'resourceLinkPlaceholder': 'https://example.com æˆ– file://...',
        'resourceLinkHelp': 'ç½‘ç«™é“¾æ¥æˆ–æœ¬åœ°æ–‡ä»¶è·¯å¾„',
        'categorySelect': 'åˆ†ç±»',
        'iconSelect': 'å›¾æ ‡',
        'submitResource': 'æäº¤',
        'backToDragbit': 'â† è¿”å› dragbit',

        'profileTitle': 'ä¸ªäººä¸­å¿ƒ',
        'profileSubtitle': 'ç®¡ç†ä½ çš„è´¦æˆ·ä¿¡æ¯',
        'member': 'ä¼šå‘˜',
        'totalResources': 'æ€»èµ„æºæ•°',
        'totalComments': 'æ€»è¯„è®ºæ•°',
        'downloadCount': 'èµ„æºä¸‹è½½æ•°',
        'accountInfo': 'è´¦æˆ·ä¿¡æ¯',
        'registerTime': 'æ³¨å†Œæ—¶é—´',
        'accountType': 'è´¦æˆ·ç±»å‹',
        'developerAccount': 'â­ å¼€å‘è€…è´¦æˆ·',
        'regularUser': 'ğŸ‘¤ æ™®é€šç”¨æˆ·',
        'developerManagement': 'å¼€å‘è€…ç®¡ç†',
        'allUsers': 'æ‰€æœ‰ç”¨æˆ·',
        'viewAllUsers': 'æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·',
        'exportUsers': 'å¯¼å‡ºç”¨æˆ·æ•°æ®',
        'changeAvatar': 'æ›´æ¢å¤´åƒ',
        'accountSettings': 'è´¦æˆ·è®¾ç½®',
        'changePassword': 'ä¿®æ”¹å¯†ç ',
        'currentPassword': 'å½“å‰å¯†ç ',
        'newPassword': 'æ–°å¯†ç ',
        'confirmNewPassword': 'ç¡®è®¤æ–°å¯†ç ',
        'newEmail': 'æ–°é‚®ç®±',
        'language': 'è¯­è¨€',
        'currentPasswordRequired': 'è¯·è¾“å…¥å½“å‰å¯†ç ',
        'currentPasswordError': 'å½“å‰å¯†ç é”™è¯¯',
        'passwordSameError': 'æ–°å¯†ç ä¸èƒ½ä¸å½“å‰å¯†ç ç›¸åŒ',
        'passwordChangeSuccess': 'å¯†ç ä¿®æ”¹æˆåŠŸï¼',
        'emailSameError': 'æ–°é‚®ç®±ä¸èƒ½ä¸å½“å‰é‚®ç®±ç›¸åŒ',
        'emailChangeSuccess': 'é‚®ç®±ä¿®æ”¹æˆåŠŸï¼',
        'emailNotSet': 'æœªè®¾ç½®',
        'userNotFound': 'ç”¨æˆ·æœªæ‰¾åˆ°',
        'currentLanguage': 'å½“å‰è¯­è¨€',
        'browserLanguage': 'æµè§ˆå™¨è¯­è¨€',
        'selectLanguage': 'é€‰æ‹©è¯­è¨€',
        'theme': 'ä¸»é¢˜è®¾ç½®',
        'currentTheme': 'å½“å‰ä¸»é¢˜ï¼š',
        'selectTheme': 'é€‰æ‹©ä¸»é¢˜',
        'themeSystem': 'è·Ÿéšç³»ç»Ÿ',
        'themeLight': 'æµ…è‰²',
        'themeDark': 'æ·±è‰²',

        'copyright': 'Â© 2024 dragbit | Made with â¤ï¸',
    },
    en: {

        'login': 'Login',
        'logout': 'Logout',
        'register': 'Register',
        'cancel': 'Cancel',
        'submit': 'Submit',
        'save': 'Save',
        'delete': 'Delete',
        'edit': 'Edit',
        'back': 'Back',
        'search': 'Search',
        'filter': 'Filter',
        'reset': 'Reset',
        'confirm': 'Confirm',
        'close': 'Close',
        'loading': 'Loading...',
        'error': 'Error',
        'success': 'Success',

        'siteName': 'dragbit',
        'siteDescription': 'High-quality resources, free download',
        'home': 'Home',
        'myResources': 'My Resources',
        'addResource': 'Add Resource',
        'profile': 'Profile',
        'personalCenter': 'Personal Center',
        'loginRequired': 'Login Required',
        'loginRequiredMessage': 'You need to login to view resources\nPlease login or register',

        'resources': 'Resources',
        'allCategories': 'All',
        'filterAll': 'All',
        'filterSoftware': 'Software',
        'filterDocument': 'Document',
        'filterMedia': 'Media',
        'filterWebsite': 'Website',
        'filterOther': 'Other',
        'software': 'Software',
        'document': 'Document',
        'media': 'Media',
        'website': 'Website',
        'other': 'Other',
        'searchPlaceholder': 'Search resources...',
        'addResourceButton': '+ Add Resource',
        'visitWebsite': 'Visit Website',
        'download': 'Download',
        'downloadLinkNotConfigured': 'The download link for dragbit "{name}" is not configured yet.',
        'viewDetails': 'View Details',
        'comments': 'Comments',
        'uploadedBy': 'Uploaded By',
        'uploader': 'Uploader: ',
        'anonymousUser': 'Anonymous User',
        'uploadedAt': 'Uploaded At',
        'tags': 'Tags',
        'category': 'Category',
        'description': 'Description',
        'author': 'Author',
        'noCommentsYet': 'No comments yet. Be the first to comment!',
        'loginToComment': 'Please login to comment',
        'viewComments': 'View Comments',

        'loginTitle': 'Login',
        'loginSubtitle': 'Account login to enjoy high-quality free resources!',
        'username': 'Username',
        'emailOrUsername': 'Email or Username',
        'password': 'Password',
        'usernamePlaceholder': 'Enter username (3-20 characters)',
        'usernamePlaceholderOptional': 'Enter username (optional, email prefix will be used if empty)',
        'loginPlaceholder': 'Enter email or username',
        'passwordPlaceholder': 'Enter password (at least 6 characters)',
        'confirmPasswordPlaceholder': 'Enter password again',
        'loginButton': 'Login',
        'registerButton': 'Register',
        'demoAccount': 'Demo Account:',
        'or': 'or',

        'registerTitle': 'âœ¨ Register',
        'registerSubtitle': 'Create an account to get started',
        'confirmPassword': 'Confirm Password',
        'email': 'Email',
        'verificationCode': 'Verification Code',
        'sendCode': 'Send Code',
        'codeSentTo': 'Verification code will be sent to this email',
        'registerSubmit': 'Register',
        'alreadyHaveAccount': 'Already have an account?',
        'loginNow': 'Login Now',
        'backToHome': 'â† Back to Home',
        'enterCode': 'Enter verification code',

        'usernameLengthError': 'Username must be between 3-20 characters',
        'passwordLengthError': 'Password must be at least 6 characters',
        'passwordMismatch': 'Passwords do not match',
        'emailRequired': 'Please enter your email address',
        'emailInvalid': 'Please enter a valid email address',
        'codeRequired': 'Please enter verification code',
        'codeError': 'Verification code is incorrect',
        'codeExpired': 'Verification code has expired, please resend',
        'codeNotSent': 'Please send verification code first',
        'codeVerificationFailed': 'Verification code feature not initialized, please refresh the page',
        'registerSuccess': 'Registration successful! Redirecting to login page...',
        'registerFailed': 'Registration failed',
        'registerFailedRetry': 'Registration failed, please try again later',
        'codeSentSuccess': 'Verification code has been sent to your email, please check!',
        'codeSendFailed': 'Failed to send email.',
        'codeSendFailedConfig': 'Please check if template configuration or variable names are correct.',
        'codeSendFailedAuth': 'Authentication failed, please check if Public Key is correct.',
        'codeSendFailedError': 'Error code: {status}, Details: {details}',
        'verificationCodeMessage': 'Your verification code is: {code}, valid for 5 minutes.',
        'codeCountdown': '{seconds} seconds before resending',

        'myResourcesTitle': 'My Resources',
        'myResourcesSubtitle': 'All resources you uploaded on dragbit',
        'noMyResources': 'You have not uploaded any resources yet',
        'addFirstResource': 'Add Your First Resource',
        'backToMain': 'Back to Home',

        'addResourceTitle': 'â• Add Resource',
        'addResourceSubtitle': 'Resources will be added to dragbit - a quality resource website',
        'addNewResource': 'Add New Resource',
        'resourceName': 'Resource Name',
        'resourceDescription': 'Resource Description',
        'resourceDetails': 'Details',
        'resourceTags': 'Tags (comma separated)',
        'exampleTags': 'Example: Free,Open Source,Windows,Chinese',
        'tagsHelp': 'Enter multiple tags separated by commas, e.g.: Free,Open Source,Windows',
        'displayImage': 'Display Image URL',
        'displayVideo': 'Display Video URL',
        'displayImagePlaceholder': 'Enter image URL (optional)',
        'displayVideoPlaceholder': 'Enter video URL (optional)',
        'imageHelp': 'Supports jpg, png, gif formats',
        'videoHelp': 'Supports YouTube, Bilibili, or other video links',
        'resourceLink': 'Resource Link',
        'resourceLinkPlaceholder': 'https://example.com or file://...',
        'resourceLinkHelp': 'Website link or local file path',
        'categorySelect': 'Category',
        'iconSelect': 'Icon',
        'submitResource': 'Submit',
        'backToDragbit': 'â† Back to dragbit',

        'profileTitle': 'Profile',
        'profileSubtitle': 'Manage your account information',
        'member': 'Member',
        'totalResources': 'Total Resources',
        'totalComments': 'Total Comments',
        'downloadCount': 'Download Count',
        'accountInfo': 'Account Information',
        'registerTime': 'Register Time',
        'accountType': 'Account Type',
        'developerAccount': 'â­ Developer Account',
        'regularUser': 'ğŸ‘¤ Regular User',
        'developerManagement': 'Developer Management',
        'allUsers': 'All Users',
        'viewAllUsers': 'View All Users',
        'exportUsers': 'Export Users Data',
        'changeAvatar': 'Change Avatar',
        'accountSettings': 'Account Settings',
        'changePassword': 'Change Password',
        'currentPassword': 'Current Password',
        'newPassword': 'New Password',
        'confirmNewPassword': 'Confirm New Password',
        'newEmail': 'New Email',
        'language': 'Language',
        'currentPasswordRequired': 'Please enter current password',
        'currentPasswordError': 'Current password is incorrect',
        'passwordSameError': 'New password cannot be the same as current password',
        'passwordChangeSuccess': 'Password changed successfully!',
        'emailSameError': 'New email cannot be the same as current email',
        'emailChangeSuccess': 'Email changed successfully!',
        'emailNotSet': 'Not set',
        'userNotFound': 'User not found',
        'currentLanguage': 'Current Language',
        'browserLanguage': 'Browser Language',
        'selectLanguage': 'Select Language',
        'theme': 'Theme Settings',
        'currentTheme': 'Current Theme:',
        'selectTheme': 'Select Theme',
        'themeSystem': 'Follow System',
        'themeLight': 'Light',
        'themeDark': 'Dark',

        'copyright': 'Â© 2024 dragbit | Made with â¤ï¸',
    }
};

(function() {
    'use strict';


    function detectBrowserLanguage() {
        try {
            let browserLang = navigator.language || navigator.userLanguage;
            
            if (!browserLang && navigator.languages && navigator.languages.length > 0) {
                browserLang = navigator.languages[0];
            }
            
            if (!browserLang) {
                console.warn('æ— æ³•è·å–æµè§ˆå™¨è¯­è¨€ï¼Œä½¿ç”¨é»˜è®¤å€¼ zh-CN');
                return 'zh';
            }
            
            const browserLangLower = browserLang.toLowerCase();
            const supportedLangs = ['zh', 'en'];
            const langCode = browserLangLower.split('-')[0];
            
            console.log('æ£€æµ‹åˆ°æµè§ˆå™¨è¯­è¨€:', browserLang, 'è§£æä¸º:', langCode);
            
            if (supportedLangs.includes(langCode)) {
                return langCode;
            }
            
            console.warn('ä¸æ”¯æŒçš„æµè§ˆå™¨è¯­è¨€ä»£ç :', langCode, 'ä½¿ç”¨é»˜è®¤å€¼ zh');
        } catch (e) {
            console.error('æ£€æµ‹æµè§ˆå™¨è¯­è¨€æ—¶å‡ºé”™:', e);
        }

        return 'zh';
    }

    function getBrowserLanguage() {
        try {
            let browserLang = navigator.language || navigator.userLanguage;
            
            if (!browserLang && navigator.languages && navigator.languages.length > 0) {
                browserLang = navigator.languages[0];
            }
            
            if (!browserLang) {
                browserLang = 'zh-CN';
            }
            
            console.log('getBrowserLanguage è¿”å›:', browserLang);
            return browserLang;
        } catch (e) {
            console.error('getBrowserLanguage é”™è¯¯:', e);
            return 'zh-CN';
        }
    }

    let currentLang = 'zh';
    let browserDetectedLang = detectBrowserLanguage();
    
    try {
        const savedLang = localStorage.getItem('language');
        if (savedLang && translations[savedLang]) {

            currentLang = savedLang;
        } else {

            currentLang = browserDetectedLang;

            try {
                localStorage.setItem('language', currentLang);
            } catch (e) {

            }
        }

        if (!translations[currentLang]) {
            currentLang = 'zh';
        }
    } catch (e) {
        currentLang = 'zh';
    }

    window.getBrowserLanguage = getBrowserLanguage;
    window.detectBrowserLanguage = detectBrowserLanguage;

    const i18n = {
        currentLang: currentLang,
        
        setLanguage: function(lang) {
            console.log('=== i18n.setLanguage å¼€å§‹ ===');
            console.log('ç›®æ ‡è¯­è¨€:', lang);
            console.log('å½“å‰è¯­è¨€:', this.currentLang);
            
            if (translations[lang]) {
                const oldLang = this.currentLang;
                this.currentLang = lang;
                
                try {
                    localStorage.setItem('language', lang);
                    console.log('âœ“ è¯­è¨€å·²ä¿å­˜åˆ° localStorage:', lang);
                } catch (e) {
                    console.error('âœ— ä¿å­˜è¯­è¨€åˆ° localStorage å¤±è´¥:', e);
                }
                
                console.log('å¼€å§‹æ›´æ–°é¡µé¢å†…å®¹...');
                this.updatePage();
                
                setTimeout(() => {
                    console.log('å»¶è¿Ÿæ›´æ–°é¡µé¢å†…å®¹ï¼ˆç¬¬ä¸€æ¬¡ï¼‰...');
                    this.updatePage();
                }, 150);
                
                setTimeout(() => {
                    console.log('å»¶è¿Ÿæ›´æ–°é¡µé¢å†…å®¹ï¼ˆç¬¬äºŒæ¬¡ï¼‰...');
                    this.updatePage();
                    
                    try {
                        const event = new CustomEvent('languageChanged', { 
                            detail: { lang: lang, oldLang: oldLang } 
                        });
                        window.dispatchEvent(event);
                        console.log('âœ“ å·²åˆ†å‘ languageChanged äº‹ä»¶');
                    } catch (e) {
                        console.error('âœ— åˆ†å‘ languageChanged äº‹ä»¶å¤±è´¥:', e);
                    }
                }, 300);
                
                setTimeout(() => {
                    console.log('æœ€ç»ˆæ›´æ–°é¡µé¢å†…å®¹...');
                    this.updatePage();
                    console.log('=== i18n.setLanguage å®Œæˆ ===');
                }, 600);
            } else {
                console.warn('âœ— ä¸æ”¯æŒçš„è¯­è¨€:', lang);
            }
        },
        
        t: function(key) {
            return translations[this.currentLang] && translations[this.currentLang][key] 
                || translations['zh'][key] 
                || key;
        },
        
        updatePage: function() {
            console.log('updatePage å¼€å§‹æ‰§è¡Œï¼Œå½“å‰è¯­è¨€:', this.currentLang);
            let updatedCount = 0;
            
            document.querySelectorAll('[data-i18n]').forEach(function(el) {
                const key = el.getAttribute('data-i18n');
                if (key) {
                    const translated = i18n.t(key);
                    updatedCount++;

                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        const placeholderKey = el.getAttribute('data-i18n-placeholder') || el.getAttribute('data-i18n');
                        if (placeholderKey) {
                            el.placeholder = i18n.t(placeholderKey);
                        }
                        if (el.value === '' || el.getAttribute('data-i18n-value')) {
                            const valueKey = el.getAttribute('data-i18n-value');
                            if (valueKey) {
                                el.value = i18n.t(valueKey);
                            }
                        }
                    } else {
                        const hasIcon = el.querySelector('i, svg, img') !== null;
                        const hasSpanWithI18n = el.querySelector('span[data-i18n]');
                        
                        if (hasSpanWithI18n) {
                            hasSpanWithI18n.textContent = translated;
                            console.log('æ›´æ–° span[data-i18n] å…ƒç´ :', key, '=', translated);
                        } else if (hasIcon) {
                            let textUpdated = false;
                            const allChildren = Array.from(el.childNodes);
                            
                            allChildren.forEach(function(node, index) {
                                if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
                                    const nodesBefore = Array.from(el.childNodes).slice(0, index);
                                    const hasIconBefore = nodesBefore.some(n => 
                                        n.nodeType === Node.ELEMENT_NODE && 
                                        (n.tagName === 'I' || n.tagName === 'SVG' || n.tagName === 'IMG')
                                    );
                                    const oldText = node.textContent;
                                    if (hasIconBefore) {
                                        node.textContent = ' ' + translated;
                                    } else {
                                        node.textContent = translated;
                                    }
                                    textUpdated = true;
                                    console.log('æ›´æ–°æ–‡æœ¬èŠ‚ç‚¹:', key, 'ä»', oldText.trim(), 'åˆ°', translated);
                                } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'SPAN' && !node.hasAttribute('data-i18n')) {
                                    if (!node.querySelector('i, svg, img')) {
                                        const oldSpanText = node.textContent;
                                        node.textContent = translated;
                                        textUpdated = true;
                                        console.log('æ›´æ–° SPAN å…ƒç´ :', key, 'ä»', oldSpanText, 'åˆ°', translated);
                                    }
                                }
                            });

                            if (!textUpdated) {
                                const firstIcon = el.querySelector('i, svg, img');
                                if (firstIcon) {
                                    const nextSibling = firstIcon.nextSibling;
                                    if (nextSibling && nextSibling.nodeType === Node.TEXT_NODE) {
                                        const oldNextText = nextSibling.textContent;
                                        nextSibling.textContent = ' ' + translated;
                                        console.log('æ›´æ–°å›¾æ ‡åçš„æ–‡æœ¬èŠ‚ç‚¹:', key, 'ä»', oldNextText.trim(), 'åˆ°', translated);
                                        textUpdated = true;
                                    } else {
                                        const existingTextNodes = Array.from(el.childNodes).filter(n => 
                                            n.nodeType === Node.TEXT_NODE && n.textContent.trim()
                                        );
                                        if (existingTextNodes.length > 0) {
                                            existingTextNodes.forEach(n => {
                                                const oldText = n.textContent;
                                                n.textContent = ' ' + translated;
                                                console.log('æ›´æ–°ç°æœ‰æ–‡æœ¬èŠ‚ç‚¹:', key, 'ä»', oldText.trim(), 'åˆ°', translated);
                                                textUpdated = true;
                                            });
                                        }
                                        if (!textUpdated) {
                                            firstIcon.insertAdjacentText('afterend', ' ' + translated);
                                            console.log('æ’å…¥æ–°æ–‡æœ¬èŠ‚ç‚¹:', key, '=', translated);
                                        }
                                    }
                                } else {
                                    const oldText = el.textContent;
                                    el.textContent = translated;
                                    console.log('æ›´æ–°å…ƒç´ æ–‡æœ¬:', key, 'ä»', oldText, 'åˆ°', translated);
                                }
                            }
                        } else {
                            const oldContent = el.textContent || el.innerHTML;
                            el.textContent = translated;
                            console.log('æ›´æ–°çº¯æ–‡æœ¬å…ƒç´ :', key, 'ä»', oldContent, 'åˆ°', translated);
                        }
                    }
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(function(el) {
                const key = el.getAttribute('data-i18n-placeholder');
                if (key && (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA')) {
                    el.placeholder = i18n.t(key);
                    updatedCount++;
                }
            });

            document.querySelectorAll('[data-i18n-title]').forEach(function(el) {
                const key = el.getAttribute('data-i18n-title');
                if (key) {
                    el.title = i18n.t(key);
                    updatedCount++;
                }
            });

            document.querySelectorAll('[data-i18n-option]').forEach(function(el) {
                const key = el.getAttribute('data-i18n-option');
                if (key && el.tagName === 'OPTION') {
                    el.textContent = i18n.t(key);
                    updatedCount++;
                }
            });

            if (document.documentElement) {
                document.documentElement.lang = this.currentLang === 'zh' ? 'zh-CN' : 'en';
            }

            console.log('updatePage å®Œæˆï¼Œå…±æ›´æ–°äº†', updatedCount, 'ä¸ªå…ƒç´ ');
            
            try {
                const event = new CustomEvent('languageChanged', { 
                    detail: { lang: this.currentLang } 
                });
                window.dispatchEvent(event);
                console.log('å·²åˆ†å‘ languageChanged äº‹ä»¶ï¼Œè¯­è¨€:', this.currentLang);
            } catch (e) {
                console.error('åˆ†å‘è¯­è¨€æ›´æ”¹äº‹ä»¶å¤±è´¥:', e);
            }
        },
        
        init: function() {
            this.updatePage();
        }
    };

    window.i18n = i18n;
    window.translations = translations;
    
    console.log('âœ“ i18n å·²åŠ è½½ï¼Œå½“å‰è¯­è¨€:', currentLang);
})();